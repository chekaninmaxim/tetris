{"ast":null,"code":"var _jsxFileName = \"/home/ovo/projects/my-app/src/components/GameStage.js\";\nimport React, { useReducer, useEffect } from 'react';\nimport BlocksGroup from './BlocksGroup';\nimport { updateScore, updateNext } from '../redux/actions';\nimport { connect } from 'react-redux';\nimport Settings, { getRealSize, addPx } from '../settings';\nimport C from '../constants';\nimport { makeInitialState, blocksReducer } from '../gamelogic.js';\nconst key2Action = {\n  '32': {\n    type: C.ROTATE\n  },\n  '37': {\n    type: C.LEFT\n  },\n  '39': {\n    type: C.RIGHT\n  },\n  '40': {\n    type: C.DOWN\n  }\n};\n\nconst GameStage = ({\n  updateScore,\n  updateNext\n}) => {\n  var _state$figure;\n\n  const style = {\n    width: addPx(getRealSize(Settings.stageSize.width)),\n    height: addPx(getRealSize(Settings.stageSize.height))\n  };\n  const [state, dispatch] = useReducer(blocksReducer, makeInitialState());\n\n  const handleKeyDown = ({\n    keyCode\n  }) => {\n    const action = key2Action[keyCode];\n    if (action) dispatch(action);\n  };\n\n  const makeRegularMove = () => dispatch({\n    type: C.DOWN\n  });\n\n  useEffect(() => {\n    if (!state.gameStatus.gameOver) {\n      document.addEventListener(\"keydown\", handleKeyDown);\n      const timerId = setInterval(makeRegularMove, Settings.updateRate);\n      return () => {\n        document.removeEventListener(\"keydown\", handleKeyDown);\n        clearInterval(timerId);\n      };\n    }\n  }, [state.gameStatus.gameOver]);\n  useEffect(() => {\n    if (state.nextFigure) {\n      updateNext(nextFigure.blocks || []);\n    }\n  }, [state.nextFigure]);\n  useEffect(() => {\n    updateScore(state.gameStatus.score);\n  }, [state.gameStatus.score]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: 'Tetris-stage',\n    style: style,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 3\n    }\n  }, /*#__PURE__*/React.createElement(BlocksGroup, {\n    key: 0,\n    blocks: (_state$figure = state.figure) === null || _state$figure === void 0 ? void 0 : _state$figure.blocks.map(block => ({\n      position: block,\n      color: state.figure.color\n    })),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 61,\n      columnNumber: 4\n    }\n  }), /*#__PURE__*/React.createElement(BlocksGroup, {\n    key: 1,\n    blocks: state.blocksMap.map((row, y) => row.reduce((filtered, color, x) => {\n      if (color) {\n        return filtered.concat({\n          position: {\n            x,\n            y\n          },\n          color: color\n        });\n      } else {\n        return filtered;\n      }\n    }, [])).flat(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 4\n    }\n  }), state.gameStatus.gameOver && /*#__PURE__*/React.createElement(\"h1\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 35\n    }\n  }, \" game over! \"));\n};\n\nconst mapDispatchToProps = {\n  updateScore,\n  updateNext\n};\nexport default connect(null, mapDispatchToProps)(GameStage);","map":{"version":3,"sources":["/home/ovo/projects/my-app/src/components/GameStage.js"],"names":["React","useReducer","useEffect","BlocksGroup","updateScore","updateNext","connect","Settings","getRealSize","addPx","C","makeInitialState","blocksReducer","key2Action","type","ROTATE","LEFT","RIGHT","DOWN","GameStage","style","width","stageSize","height","state","dispatch","handleKeyDown","keyCode","action","makeRegularMove","gameStatus","gameOver","document","addEventListener","timerId","setInterval","updateRate","removeEventListener","clearInterval","nextFigure","blocks","score","figure","map","block","position","color","blocksMap","row","y","reduce","filtered","x","concat","flat","mapDispatchToProps"],"mappings":";AACA,OAAOA,KAAP,IAAeC,UAAf,EAA2BC,SAA3B,QAA2C,OAA3C;AACA,OAAOC,WAAP,MAAwB,eAAxB;AAEA,SAASC,WAAT,EAAsBC,UAAtB,QAAwC,kBAAxC;AACA,SAASC,OAAT,QAAwB,aAAxB;AAEA,OAAOC,QAAP,IAAkBC,WAAlB,EAA+BC,KAA/B,QAA2C,aAA3C;AACA,OAAOC,CAAP,MAAc,cAAd;AACA,SACEC,gBADF,EAEEC,aAFF,QAGO,iBAHP;AAKA,MAAMC,UAAU,GAAG;AACjB,QAAM;AAACC,IAAAA,IAAI,EAAEJ,CAAC,CAACK;AAAT,GADW;AAEjB,QAAM;AAACD,IAAAA,IAAI,EAAEJ,CAAC,CAACM;AAAT,GAFW;AAGjB,QAAM;AAACF,IAAAA,IAAI,EAAEJ,CAAC,CAACO;AAAT,GAHW;AAIjB,QAAM;AAACH,IAAAA,IAAI,EAAEJ,CAAC,CAACQ;AAAT;AAJW,CAAnB;;AAOA,MAAMC,SAAS,GAAG,CAAC;AAAEf,EAAAA,WAAF;AAAeC,EAAAA;AAAf,CAAD,KAAiC;AAAA;;AAElD,QAAMe,KAAK,GAAG;AACbC,IAAAA,KAAK,EAAEZ,KAAK,CAACD,WAAW,CAACD,QAAQ,CAACe,SAAT,CAAmBD,KAApB,CAAZ,CADC;AAEbE,IAAAA,MAAM,EAAEd,KAAK,CAACD,WAAW,CAACD,QAAQ,CAACe,SAAT,CAAmBC,MAApB,CAAZ;AAFA,GAAd;AAKA,QAAM,CAACC,KAAD,EAAQC,QAAR,IAAoBxB,UAAU,CAACW,aAAD,EAAgBD,gBAAgB,EAAhC,CAApC;;AAEA,QAAMe,aAAa,GAAG,CAAC;AAACC,IAAAA;AAAD,GAAD,KAAe;AACpC,UAAMC,MAAM,GAAGf,UAAU,CAACc,OAAD,CAAzB;AACA,QAAIC,MAAJ,EAAYH,QAAQ,CAACG,MAAD,CAAR;AACZ,GAHD;;AAKA,QAAMC,eAAe,GAAG,MAAMJ,QAAQ,CAAC;AAAEX,IAAAA,IAAI,EAAGJ,CAAC,CAACQ;AAAX,GAAD,CAAtC;;AAEAhB,EAAAA,SAAS,CAAC,MAAM;AACf,QAAI,CAACsB,KAAK,CAACM,UAAN,CAAiBC,QAAtB,EAAgC;AAC/BC,MAAAA,QAAQ,CAACC,gBAAT,CAA0B,SAA1B,EAAqCP,aAArC;AACA,YAAMQ,OAAO,GAAGC,WAAW,CAACN,eAAD,EAAkBtB,QAAQ,CAAC6B,UAA3B,CAA3B;AACA,aAAO,MAAM;AACZJ,QAAAA,QAAQ,CAACK,mBAAT,CAA6B,SAA7B,EAAwCX,aAAxC;AACAY,QAAAA,aAAa,CAACJ,OAAD,CAAb;AACA,OAHD;AAIA;AACD,GATQ,EASN,CAACV,KAAK,CAACM,UAAN,CAAiBC,QAAlB,CATM,CAAT;AAWA7B,EAAAA,SAAS,CAAC,MAAM;AACf,QAAIsB,KAAK,CAACe,UAAV,EAAsB;AACrBlC,MAAAA,UAAU,CAACkC,UAAU,CAACC,MAAX,IAAqB,EAAtB,CAAV;AACA;AACD,GAJQ,EAIN,CAAChB,KAAK,CAACe,UAAP,CAJM,CAAT;AAMArC,EAAAA,SAAS,CAAC,MAAM;AACfE,IAAAA,WAAW,CAACoB,KAAK,CAACM,UAAN,CAAiBW,KAAlB,CAAX;AACA,GAFQ,EAEN,CAACjB,KAAK,CAACM,UAAN,CAAiBW,KAAlB,CAFM,CAAT;AAIA,sBACC;AAAK,IAAA,SAAS,EAAE,cAAhB;AAAgC,IAAA,KAAK,EAAErB,KAAvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACC,oBAAC,WAAD;AACC,IAAA,GAAG,EAAE,CADN;AAEC,IAAA,MAAM,mBACLI,KAAK,CAACkB,MADD,kDACL,cAAcF,MAAd,CAAqBG,GAArB,CAAyBC,KAAK,KAAK;AAClCC,MAAAA,QAAQ,EAAED,KADwB;AAElCE,MAAAA,KAAK,EAAEtB,KAAK,CAACkB,MAAN,CAAaI;AAFc,KAAL,CAA9B,CAHF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADD,eAUC,oBAAC,WAAD;AACC,IAAA,GAAG,EAAE,CADN;AAEC,IAAA,MAAM,EACLtB,KAAK,CAACuB,SAAN,CAAgBJ,GAAhB,CAAoB,CAACK,GAAD,EAAMC,CAAN,KAAYD,GAAG,CAACE,MAAJ,CAAW,CAACC,QAAD,EAAWL,KAAX,EAAkBM,CAAlB,KAAwB;AAClE,UAAIN,KAAJ,EAAW;AACV,eAAOK,QAAQ,CAACE,MAAT,CAAgB;AACtBR,UAAAA,QAAQ,EAAE;AAAEO,YAAAA,CAAF;AAAKH,YAAAA;AAAL,WADY;AAEtBH,UAAAA,KAAK,EAAEA;AAFe,SAAhB,CAAP;AAIA,OALD,MAKO;AACN,eAAOK,QAAP;AACA;AACD,KAT+B,EAS7B,EAT6B,CAAhC,EASQG,IATR,EAHF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAVD,EAyBG9B,KAAK,CAACM,UAAN,CAAiBC,QAAjB,iBAA6B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAzBhC,CADD;AA6BA,CAlED;;AAoEA,MAAMwB,kBAAkB,GAAG;AAAEnD,EAAAA,WAAF;AAAeC,EAAAA;AAAf,CAA3B;AAEA,eAAeC,OAAO,CAAC,IAAD,EAAOiD,kBAAP,CAAP,CAAkCpC,SAAlC,CAAf","sourcesContent":["\nimport React, {useReducer, useEffect} from 'react';\nimport BlocksGroup from './BlocksGroup';\n\nimport { updateScore, updateNext } from '../redux/actions'\nimport { connect } from 'react-redux'\n\nimport Settings, {getRealSize, addPx} from '../settings';\nimport C from '../constants'\nimport {\n  makeInitialState,\n  blocksReducer\n} from '../gamelogic.js';\n\nconst key2Action = {\n  '32': {type: C.ROTATE},\n  '37': {type: C.LEFT},\n  '39': {type: C.RIGHT},\n  '40': {type: C.DOWN}\n}\n\nconst GameStage = ({ updateScore, updateNext }) => {\n\n\tconst style = {\n\t\twidth: addPx(getRealSize(Settings.stageSize.width)),\n\t\theight: addPx(getRealSize(Settings.stageSize.height))\n\t}\n\n\tconst [state, dispatch] = useReducer(blocksReducer, makeInitialState());\n\n\tconst handleKeyDown = ({keyCode}) => {\n\t\tconst action = key2Action[keyCode];\n\t\tif (action) dispatch(action);\n\t}\n\n\tconst makeRegularMove = () => dispatch({ type : C.DOWN });\n\n\tuseEffect(() => {\n\t\tif (!state.gameStatus.gameOver) {\n\t\t\tdocument.addEventListener(\"keydown\", handleKeyDown);\n\t\t\tconst timerId = setInterval(makeRegularMove, Settings.updateRate);\n\t\t\treturn () => {\n\t\t\t\tdocument.removeEventListener(\"keydown\", handleKeyDown);\n\t\t\t\tclearInterval(timerId);\n\t\t\t}\n\t\t}\n\t}, [state.gameStatus.gameOver]);\n\n\tuseEffect(() => {\n\t\tif (state.nextFigure) {\n\t\t\tupdateNext(nextFigure.blocks || [])\n\t\t}\n\t}, [state.nextFigure])\n\n\tuseEffect(() => {\n\t\tupdateScore(state.gameStatus.score)\n\t}, [state.gameStatus.score])\n\n\treturn (\n\t\t<div className={'Tetris-stage'} style={style} >\t\n\t\t\t<BlocksGroup\n\t\t\t\tkey={0}\n\t\t\t\tblocks={\n\t\t\t\t\tstate.figure?.blocks.map(block => ({\n\t\t\t\t\t\tposition: block,\n\t\t\t\t\t\tcolor: state.figure.color\n\t\t\t\t\t}))\n\t\t\t\t}\n\t\t\t/> \n\t\t\t<BlocksGroup\n\t\t\t\tkey={1}\n\t\t\t\tblocks={\n\t\t\t\t\tstate.blocksMap.map((row, y) => row.reduce((filtered, color, x) => {\n\t\t\t\t\t\tif (color) {\n\t\t\t\t\t\t\treturn filtered.concat({\n\t\t\t\t\t\t\t\tposition: { x, y },\n\t\t\t\t\t\t\t\tcolor: color\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn filtered;\n\t\t\t\t\t\t}\n\t\t\t\t\t}, [])).flat()\n\t\t\t\t}\n\t\t\t/>\n\t\t\t{ state.gameStatus.gameOver && <h1> game over! </h1> }\n\t\t</div>\n\t)\n}\n\nconst mapDispatchToProps = { updateScore, updateNext }\n\nexport default connect(null, mapDispatchToProps)(GameStage);"]},"metadata":{},"sourceType":"module"}