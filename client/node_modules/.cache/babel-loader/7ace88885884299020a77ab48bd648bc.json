{"ast":null,"code":"import Settings from './settings';\n\nclass AbstractTetrisFigure {\n  constructor(startPosition, rotation, color = '#00ff00') {\n    this.position = this.ensureInside(startPosition, rotation);\n    this.rotation = rotation % 4;\n    this.color = color;\n  }\n\n  get blocks() {\n    throw \"Not implemented\";\n  }\n\n  ensureInside(position, rotation) {\n    throw \"Not Implemented\";\n  }\n\n}\n\nclass TetrisPedestal extends AbstractTetrisFigure {\n  get blocks() {\n    const {\n      x,\n      y\n    } = this.position;\n\n    switch (this.rotation) {\n      case 0:\n        return [{\n          x,\n          y\n        }, {\n          x: x - 1,\n          y\n        }, {\n          x: x + 1,\n          y\n        }, {\n          x,\n          y: y - 1\n        }];\n\n      case 1:\n        return [{\n          x,\n          y\n        }, {\n          x: x + 1,\n          y\n        }, {\n          x,\n          y: y - 1\n        }, {\n          x,\n          y: y + 1\n        }];\n\n      case 2:\n        return [{\n          x,\n          y\n        }, {\n          x: x - 1,\n          y\n        }, {\n          x: x + 1,\n          y\n        }, {\n          x,\n          y: y + 1\n        }];\n\n      case 3:\n        return [{\n          x,\n          y\n        }, {\n          x: x - 1,\n          y\n        }, {\n          x,\n          y: y - 1\n        }, {\n          x,\n          y: y + 1\n        }];\n\n      default:\n        return [];\n    }\n  }\n\n  ensureInside({\n    x,\n    y\n  }, rotation) {\n    return {\n      x: Math.max(rotation === 1 ? 0 : 1, Math.min(x, Settings.stageSize.width - (rotation === 3 ? 1 : 2))),\n      y: Math.max(rotation === 2 ? 0 : 1, Math.min(y, Settings.stageSize.height - (rotation === 0 ? 1 : 2)))\n    };\n  }\n\n}\n\nclass TetrisSquare extends AbstractTetrisFigure {\n  get blocks() {\n    const {\n      x,\n      y\n    } = this.position;\n    return [{\n      x,\n      y\n    }, {\n      x: x + 1,\n      y\n    }, {\n      x,\n      y: y + 1\n    }, {\n      x: x + 1,\n      y: y + 1\n    }];\n  }\n\n  ensureInside({\n    x,\n    y\n  }, rotation) {\n    return {\n      x: Math.max(0, Math.min(x, Settings.stageSize.width - 2)),\n      y: Math.max(0, Math.min(y, Settings.stageSize.height - 2))\n    };\n  }\n\n}\n\nclass TetrisLine extends AbstractTetrisFigure {\n  get blocks() {\n    const {\n      x,\n      y\n    } = this.position;\n\n    if (this.rotation % 2) {\n      return [{\n        x,\n        y\n      }, {\n        x: x + 1,\n        y\n      }, {\n        x: x + 2,\n        y\n      }, {\n        x: x + 3,\n        y\n      }];\n    } else {\n      return [{\n        x,\n        y\n      }, {\n        x,\n        y: y + 1\n      }, {\n        x,\n        y: y + 2\n      }, {\n        x,\n        y: y + 3\n      }];\n    }\n  }\n\n  ensureInside({\n    x,\n    y\n  }, rotation) {\n    return {\n      x: Math.max(0, Math.min(x, Settings.stageSize.width - (rotation % 2 === 1 ? 4 : 1))),\n      y: Math.max(0, Math.min(y, Settings.stageSize.height - (rotation % 2 === 0 ? 4 : 1)))\n    };\n  }\n\n}\n\nclass TetrisLeftStep extends AbstractTetrisFigure {\n  get blocks() {\n    const {\n      x,\n      y\n    } = this.position;\n\n    if (this.rotation % 2) {\n      return [{\n        x,\n        y: y - 1\n      }, {\n        x,\n        y\n      }, {\n        x: x + 1,\n        y: y\n      }, {\n        x: x + 1,\n        y: y + 1\n      }];\n    } else {\n      return [{\n        x: x - 1,\n        y\n      }, {\n        x,\n        y\n      }, {\n        x,\n        y: y - 1\n      }, {\n        x: x + 1,\n        y: y - 1\n      }];\n    }\n  }\n\n  ensureInside({\n    x,\n    y\n  }, rotation) {\n    return {\n      x: Math.max(rotation % 2 ? 0 : 1, Math.min(x, Settings.stageSize.width - 2)),\n      y: Math.max(1, Math.min(y, Settings.stageSize.height - (rotation % 2 ? 2 : 1)))\n    };\n  }\n\n}\n\nclass TetrisRightStep extends AbstractTetrisFigure {\n  get blocks() {\n    const {\n      x,\n      y\n    } = this.position;\n\n    if (this.rotation % 2) {\n      return [{\n        x,\n        y: y + 1\n      }, {\n        x,\n        y\n      }, {\n        x: x + 1,\n        y\n      }, {\n        x: x + 1,\n        y: y - 1\n      }];\n    } else {\n      return [{\n        x: x - 1,\n        y\n      }, {\n        x,\n        y\n      }, {\n        x,\n        y: y + 1\n      }, {\n        x: x + 1,\n        y: y + 1\n      }];\n    }\n  }\n\n  ensureInside({\n    x,\n    y\n  }, rotation) {\n    return {\n      x: Math.max(rotation % 2 ? 0 : 1, Math.min(x, Settings.stageSize.width - 2)),\n      y: Math.max(rotation % 2 ? 1 : 0, Math.min(y, Settings.stageSize.height - 2))\n    };\n  }\n\n}\n\nclass TetrisLShape extends AbstractTetrisFigure {\n  get blocks() {\n    const {\n      x,\n      y\n    } = this.position;\n\n    switch (this.rotation) {\n      case 0:\n        return [{\n          x,\n          y\n        }, {\n          x: x - 1,\n          y\n        }, {\n          x: x + 1,\n          y\n        }, {\n          x: x + 1,\n          y: y - 1\n        }];\n\n      case 1:\n        return [{\n          x,\n          y\n        }, {\n          x: x + 1,\n          y: y + 1\n        }, {\n          x,\n          y: y - 1\n        }, {\n          x,\n          y: y + 1\n        }];\n\n      case 2:\n        return [{\n          x,\n          y\n        }, {\n          x: x - 1,\n          y\n        }, {\n          x: x + 1,\n          y\n        }, {\n          x: x - 1,\n          y: y + 1\n        }];\n\n      case 3:\n        return [{\n          x,\n          y\n        }, {\n          x: x - 1,\n          y: y - 1\n        }, {\n          x,\n          y: y - 1\n        }, {\n          x,\n          y: y + 1\n        }];\n\n      default:\n        return [];\n    }\n  }\n\n  ensureInside({\n    x,\n    y\n  }, rotation) {\n    return {\n      x: Math.max(rotation === 1 ? 0 : 1, Math.min(x, Settings.stageSize.width - (rotation === 3 ? 1 : 2))),\n      y: Math.max(rotation === 2 ? 0 : 1, Math.min(y, Settings.stageSize.height - (rotation === 0 ? 1 : 2)))\n    };\n  }\n\n}\n\nclass TetrisLShapeMirror extends AbstractTetrisFigure {\n  get blocks() {\n    const {\n      x,\n      y\n    } = this.position;\n\n    switch (this.rotation) {\n      case 0:\n        return [{\n          x,\n          y\n        }, {\n          x: x - 1,\n          y\n        }, {\n          x: x + 1,\n          y\n        }, {\n          x: x - 1,\n          y: y - 1\n        }];\n\n      case 1:\n        return [{\n          x,\n          y\n        }, {\n          x: x + 1,\n          y: y - 1\n        }, {\n          x,\n          y: y - 1\n        }, {\n          x,\n          y: y + 1\n        }];\n\n      case 2:\n        return [{\n          x,\n          y\n        }, {\n          x: x - 1,\n          y\n        }, {\n          x: x + 1,\n          y\n        }, {\n          x: x + 1,\n          y: y + 1\n        }];\n\n      case 3:\n        return [{\n          x,\n          y\n        }, {\n          x: x - 1,\n          y: y + 1\n        }, {\n          x,\n          y: y - 1\n        }, {\n          x,\n          y: y + 1\n        }];\n\n      default:\n        return [];\n    }\n  }\n\n  ensureInside({\n    x,\n    y\n  }, rotation) {\n    return {\n      x: Math.max(rotation === 1 ? 0 : 1, Math.min(x, Settings.stageSize.width - (rotation === 3 ? 1 : 2))),\n      y: Math.max(rotation === 2 ? 0 : 1, Math.min(y, Settings.stageSize.height - (rotation === 0 ? 1 : 2)))\n    };\n  }\n\n}\n\nconst constructors = [(point, rotation, color) => new TetrisSquare(point, rotation, color), (point, rotation, color) => new TetrisLeftStep(point, rotation, color), (point, rotation, color) => new TetrisRightStep(point, rotation, color), (point, rotation, color) => new TetrisPedestal(point, rotation, color), (point, rotation, color) => new TetrisLine(point, rotation, color), (point, rotation, color) => new TetrisLShape(point, rotation, color), (point, rotation, color) => new TetrisLShapeMirror(point, rotation, color)];\nexport function getRandomFigure() {\n  const color = '#' + Math.floor(Math.random() * 16777215).toString(16);\n  const point = {\n    y: 0,\n    x: Math.floor(Math.random() * Settings.stageSize.width)\n  };\n  const rotation = Math.floor(Math.random() * 4);\n  const shapeIdx = Math.floor(Math.random() * constructors.length);\n  return constructors[shapeIdx](point, rotation, color);\n}","map":{"version":3,"sources":["/home/ovo/projects/my-app/src/figure.js"],"names":["Settings","AbstractTetrisFigure","constructor","startPosition","rotation","color","position","ensureInside","blocks","TetrisPedestal","x","y","Math","max","min","stageSize","width","height","TetrisSquare","TetrisLine","TetrisLeftStep","TetrisRightStep","TetrisLShape","TetrisLShapeMirror","constructors","point","getRandomFigure","floor","random","toString","shapeIdx","length"],"mappings":"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","sourcesContent":["import Settings from './settings';\n\nclass AbstractTetrisFigure {\n\tconstructor(startPosition, rotation, color = '#00ff00') {\n\t\tthis.position = this.ensureInside(startPosition, rotation);\n\t\tthis.rotation = rotation % 4;\n\t\tthis.color = color\n\t}\n\n\tget blocks() {\n\t\tthrow \"Not implemented\";\n\t}\n\n\tensureInside(position, rotation) {\n\t\tthrow \"Not Implemented\"\n\t}\n}\n\nclass TetrisPedestal extends AbstractTetrisFigure {\n\n\tget blocks() {\n\t\tconst {x, y} = this.position\n\t\tswitch (this.rotation) {\n\t\t\tcase 0:\n\t\t\t\treturn [\n\t\t\t\t\t{ x, y },\n\t\t\t\t\t{ x: x - 1, y },\n\t\t\t\t\t{ x: x + 1, y },\n\t\t\t\t\t{ x, y: y - 1 }\n\t\t\t\t];\n\t\t\tcase 1:\n\t\t\t\treturn [\n\t\t\t\t\t{ x, y },\n\t\t\t\t\t{ x: x + 1, y },\n\t\t\t\t\t{ x, y: y - 1 },\n\t\t\t\t\t{ x, y: y + 1 }\n\t\t\t\t]\n\t\t\tcase 2:\n\t\t\t\treturn [\n\t\t\t\t\t{ x, y },\n\t\t\t\t\t{ x: x - 1, y },\n\t\t\t\t\t{ x: x + 1, y },\n\t\t\t\t\t{ x, y: y + 1 }\n\t\t\t\t]\n\t\t\tcase 3:\n\t\t\t\treturn [\n\t\t\t\t\t{ x, y },\n\t\t\t\t\t{ x: x - 1, y },\n\t\t\t\t\t{ x, y: y - 1 },\n\t\t\t\t\t{ x, y: y + 1 }\n\t\t\t\t]\n\t\t\tdefault: return []\n\t\t}\n\t}\n\n\tensureInside({x, y}, rotation) {\n\t\treturn {\n\t\t\tx: Math.max(\n\t\t\t\trotation === 1 ? 0 : 1,\n\t\t\t\tMath.min(x, Settings.stageSize.width - (rotation === 3 ? 1 : 2))),\n\n\t\t\ty: Math.max(\n\t\t\t\trotation === 2 ? 0 : 1,\n\t\t\t\tMath.min(y, Settings.stageSize.height - (rotation === 0 ? 1 : 2)))\n\t\t}\n\t}\n\n}\n\nclass TetrisSquare extends AbstractTetrisFigure {\n\n\tget blocks() {\n\t\tconst { x, y } = this.position\n\n\t\treturn [\n\t\t\t{ x, y },\n\t\t\t{ x: x + 1, y },\n\t\t\t{ x, y: y + 1 },\n\t\t\t{ x: x + 1, y: y + 1 },\n\n\t\t];\n\t}\n\n\tensureInside({x, y}, rotation) {\n\t\treturn {\n\t\t\tx: Math.max(0, Math.min(x, Settings.stageSize.width - 2)),\n\t\t\ty: Math.max(0, Math.min(y, Settings.stageSize.height - 2))\n\t\t}\n\t}\n\n}\n\nclass TetrisLine extends AbstractTetrisFigure {\n\n\tget blocks() {\n\t\tconst { x, y } = this.position\n\n\t\tif (this.rotation % 2) {\n\t\t\treturn [\n\t\t\t\t{ x, y },\n\t\t\t\t{ x: x + 1, y },\n\t\t\t\t{ x: x + 2, y },\n\t\t\t\t{ x: x + 3, y },\n\t\t\t];\n\t\t} else {\n\t\t\treturn [\n\t\t\t\t{ x, y },\n\t\t\t\t{ x, y: y + 1 },\n\t\t\t\t{ x, y: y + 2 },\n\t\t\t\t{ x, y: y + 3 },\n\t\t\t];\n\t\t}\n\t}\n\n\tensureInside({ x, y }, rotation) {\n\t\treturn {\n\t\t\tx: Math.max(0, Math.min(x, Settings.stageSize.width - (rotation % 2 === 1 ? 4 : 1))),\n\t\t\ty: Math.max(0, Math.min(y, Settings.stageSize.height - (rotation % 2 === 0 ? 4 : 1)))\n\t\t}\n\t}\n\n}\n\nclass TetrisLeftStep extends AbstractTetrisFigure {\n\n\tget blocks() {\n\t\tconst { x, y } = this.position\n\n\t\tif (this.rotation % 2) {\n\t\t\treturn [\n\t\t\t\t{ x, y: y - 1 },\n\t\t\t\t{ x, y },\n\t\t\t\t{ x: x + 1, y: y },\n\t\t\t\t{ x: x + 1, y: y + 1},\n\t\t\t];\n\t\t} else {\n\t\t\treturn [\n\t\t\t\t{ x: x - 1, y },\n\t\t\t\t{ x, y },\n\t\t\t\t{ x, y: y - 1 },\n\t\t\t\t{ x: x + 1, y: y - 1 },\n\t\t\t];\n\t\t}\n\t}\n\n\tensureInside({ x, y }, rotation) {\n\t\treturn {\n\t\t\tx: Math.max(rotation % 2 ? 0 : 1, Math.min(x, Settings.stageSize.width - 2)),\n\t\t\ty: Math.max(1, Math.min(y, Settings.stageSize.height - (rotation % 2 ? 2 : 1)))\n\t\t}\n\t}\n}\n\nclass TetrisRightStep extends AbstractTetrisFigure {\n\n\tget blocks() {\n\t\tconst { x, y } = this.position\n\n\t\tif (this.rotation % 2) {\n\t\t\treturn [\n\t\t\t\t{ x, y: y + 1 },\n\t\t\t\t{ x, y },\n\t\t\t\t{ x: x + 1, y },\n\t\t\t\t{ x: x + 1, y: y - 1 },\n\t\t\t];\n\t\t} else {\n\t\t\treturn [\n\t\t\t\t{ x: x - 1, y },\n\t\t\t\t{ x, y },\n\t\t\t\t{ x, y: y + 1 },\n\t\t\t\t{ x: x + 1, y: y + 1 },\n\t\t\t];\n\t\t}\n\t}\n\n\tensureInside({ x, y }, rotation) {\n\t\treturn {\n\t\t\tx: Math.max(rotation % 2 ? 0 : 1, Math.min(x, Settings.stageSize.width - 2)),\n\t\t\ty: Math.max(rotation % 2 ? 1 : 0, Math.min(y, Settings.stageSize.height - 2))\n\t\t}\n\t}\n\n}\n\nclass TetrisLShape extends AbstractTetrisFigure {\n\n\tget blocks() {\n\t\tconst { x, y } = this.position;\n\n\t\tswitch (this.rotation) {\n\t\t\tcase 0:\n\t\t\t\treturn [\n\t\t\t\t\t{ x, y },\n\t\t\t\t\t{ x: x - 1, y },\n\t\t\t\t\t{ x: x + 1, y },\n\t\t\t\t\t{ x: x + 1, y: y - 1 }\n\t\t\t\t];\n\t\t\tcase 1:\n\t\t\t\treturn [\n\t\t\t\t\t{ x, y },\n\t\t\t\t\t{ x: x + 1, y: y + 1 },\n\t\t\t\t\t{ x, y: y - 1 },\n\t\t\t\t\t{ x, y: y + 1 }\n\t\t\t\t]\n\t\t\tcase 2:\n\t\t\t\treturn [\n\t\t\t\t\t{ x, y },\n\t\t\t\t\t{ x: x - 1, y },\n\t\t\t\t\t{ x: x + 1, y },\n\t\t\t\t\t{ x: x - 1, y: y + 1 }\n\t\t\t\t]\n\t\t\tcase 3:\n\t\t\t\treturn [\n\t\t\t\t\t{ x, y },\n\t\t\t\t\t{ x: x - 1, y: y - 1 },\n\t\t\t\t\t{ x, y: y - 1 },\n\t\t\t\t\t{ x, y: y + 1 }\n\t\t\t\t]\n\t\t\tdefault: return []\n\t\t}\n\t}\n\n\tensureInside({ x, y }, rotation) {\n\t\treturn {\n\t\t\tx: Math.max(rotation === 1 ? 0 : 1, Math.min(x, Settings.stageSize.width - (rotation === 3 ? 1 : 2))),\n\t\t\ty: Math.max(rotation === 2 ? 0 : 1, Math.min(y, Settings.stageSize.height - (rotation === 0 ? 1 : 2)))\n\t\t}\n\t}\n\n}\n\nclass TetrisLShapeMirror extends AbstractTetrisFigure {\n\n\tget blocks() {\n\t\tconst { x, y } = this.position;\n\n\t\tswitch (this.rotation) {\n\t\t\tcase 0:\n\t\t\t\treturn [\n\t\t\t\t\t{ x, y },\n\t\t\t\t\t{ x: x - 1, y },\n\t\t\t\t\t{ x: x + 1, y },\n\t\t\t\t\t{ x: x - 1, y: y - 1 }\n\t\t\t\t];\n\t\t\tcase 1:\n\t\t\t\treturn [\n\t\t\t\t\t{ x, y },\n\t\t\t\t\t{ x: x + 1, y: y - 1 },\n\t\t\t\t\t{ x, y: y - 1 },\n\t\t\t\t\t{ x, y: y + 1 }\n\t\t\t\t]\n\t\t\tcase 2:\n\t\t\t\treturn [\n\t\t\t\t\t{ x, y },\n\t\t\t\t\t{ x: x - 1, y },\n\t\t\t\t\t{ x: x + 1, y },\n\t\t\t\t\t{ x: x + 1, y: y + 1 }\n\t\t\t\t]\n\t\t\tcase 3:\n\t\t\t\treturn [\n\t\t\t\t\t{ x, y },\n\t\t\t\t\t{ x: x - 1, y: y + 1 },\n\t\t\t\t\t{ x, y: y - 1 },\n\t\t\t\t\t{ x, y: y + 1 }\n\t\t\t\t]\n\t\t\tdefault: return []\n\t\t}\n\t}\n\n\tensureInside({ x, y }, rotation) {\n\t\treturn {\n\t\t\tx: Math.max(rotation === 1 ? 0 : 1, Math.min(x, Settings.stageSize.width - (rotation === 3 ? 1 : 2))),\n\t\t\ty: Math.max(rotation === 2 ? 0 : 1, Math.min(y, Settings.stageSize.height - (rotation === 0 ? 1 : 2)))\n\t\t}\n\t}\n\n}\n\nconst constructors = [\n\t(point, rotation, color) => new TetrisSquare(point, rotation, color),\n\t(point, rotation, color) => new TetrisLeftStep(point, rotation, color),\n\t(point, rotation, color) => new TetrisRightStep(point, rotation, color),\n\t(point, rotation, color) => new TetrisPedestal(point, rotation, color),\n\t(point, rotation, color) => new TetrisLine(point, rotation, color),\n\t(point, rotation, color) => new TetrisLShape(point, rotation, color),\n\t(point, rotation, color) => new TetrisLShapeMirror(point, rotation, color),\n];\n\nexport function getRandomFigure() {\n\tconst color = '#' + Math.floor(Math.random() * 16777215).toString(16);\n\tconst point = {y : 0, x : Math.floor(Math.random() * Settings.stageSize.width)};\n\tconst rotation = Math.floor(Math.random() * 4);\n\tconst shapeIdx = Math.floor(Math.random() * constructors.length);\n\n\treturn constructors[shapeIdx](point, rotation, color);\n}"]},"metadata":{},"sourceType":"module"}