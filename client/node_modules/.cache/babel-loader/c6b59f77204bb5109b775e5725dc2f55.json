{"ast":null,"code":"var _jsxFileName = \"/home/ovo/projects/my-app/src/components/GameStage.js\";\nimport React from 'react';\nimport Settings, { getRealSize, addPx } from '../settings.js';\nimport TetrisBlock from './TetrisBlock.js';\nimport { getMovableBlock, TetrisFigure } from '../block.js';\nimport { makeInitialState, moveBlocksDown, moveBlocksLeft, moveBlocksRight } from '../state.js';\nconst keyActions = {\n  '37': moveBlocksLeft,\n  '39': moveBlocksRight,\n  '40': moveBlocksDown\n};\n\nclass GameStage extends React.Component {\n  constructor(props) {\n    super(props);\n    this.stageWidth = Settings.stageSize.width;\n    this.stageHeight = Settings.stageSize.height;\n    this.style = {\n      width: addPx(getRealSize(this.stageWidth)),\n      height: addPx(getRealSize(this.stageHeight))\n    };\n    this.state = makeInitialState();\n    this._handleKeyDown = this._handleKeyDown.bind(this);\n    this._makeRegularMove = this._makeRegularMove.bind(this);\n  }\n\n  _handleKeyDown(event) {\n    const handler = keyActions[event.keyCode];\n    if (handler) this.setState(handler);\n  }\n\n  _makeRegularMove() {\n    if (this.state.movableBlocks.length) {\n      this.setState(moveBlocksDown);\n    } else {\n      this.setState({\n        figure: getMovableBlock()\n      });\n    }\n  }\n\n  componentDidMount() {\n    document.addEventListener(\"keydown\", this._handleKeyDown);\n    this.timerId = setInterval(this._makeRegularMove, Settings.updateRate);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener(\"keydown\", this._handleKeyDown);\n    clearInterval(this.timerID);\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: 'Tetris-stage',\n      style: this.style,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 61,\n        columnNumber: 7\n      }\n    }, this.state.figure && this.state.figure.blocks.map((block, idx) => /*#__PURE__*/React.createElement(TetrisBlock, {\n      key: idx,\n      position: block,\n      color: this.state.figure.color,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 62,\n        columnNumber: 76\n      }\n    })), this.state.blocksMap.map(function (row, y) {\n      return row.reduce(function (filtered, block, x) {\n        if (block) {\n          return filtered.concat( /*#__PURE__*/React.createElement(TetrisBlock, {\n            key: y * Settings.stageSize.width + x,\n            position: {\n              x,\n              y\n            },\n            color: block,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 72,\n              columnNumber: 17\n            }\n          }));\n        } else {\n          return filtered;\n        }\n      }, []);\n    }));\n  }\n\n}\n\nexport default GameStage;","map":{"version":3,"sources":["/home/ovo/projects/my-app/src/components/GameStage.js"],"names":["React","Settings","getRealSize","addPx","TetrisBlock","getMovableBlock","TetrisFigure","makeInitialState","moveBlocksDown","moveBlocksLeft","moveBlocksRight","keyActions","GameStage","Component","constructor","props","stageWidth","stageSize","width","stageHeight","height","style","state","_handleKeyDown","bind","_makeRegularMove","event","handler","keyCode","setState","movableBlocks","length","figure","componentDidMount","document","addEventListener","timerId","setInterval","updateRate","componentWillUnmount","removeEventListener","clearInterval","timerID","render","blocks","map","block","idx","color","blocksMap","row","y","reduce","filtered","x","concat"],"mappings":"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","sourcesContent":["\nimport React from 'react';\nimport Settings, {getRealSize, addPx} from '../settings.js';\nimport TetrisBlock from './TetrisBlock.js';\nimport {getMovableBlock, TetrisFigure} from '../block.js';\nimport {\n  makeInitialState,\n  moveBlocksDown,\n  moveBlocksLeft,\n  moveBlocksRight,\n\n  } from '../state.js';\n\nconst keyActions = {\n  '37' : moveBlocksLeft,\n  '39' : moveBlocksRight,\n  '40' : moveBlocksDown\n}\n\nclass GameStage extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.stageWidth = Settings.stageSize.width;\n    this.stageHeight = Settings.stageSize.height;\n    this.style = {\n      width: addPx(getRealSize(this.stageWidth)),\n      height: addPx(getRealSize(this.stageHeight))\n    }\n\n    this.state = makeInitialState();\n    this._handleKeyDown = this._handleKeyDown.bind(this);\n    this._makeRegularMove = this._makeRegularMove.bind(this);\n  }\n\n  _handleKeyDown(event) {\n    const handler = keyActions[event.keyCode];\n    if (handler) this.setState(handler);\n  }\n\n  _makeRegularMove() {\n    if (this.state.movableBlocks.length) {\n      this.setState(moveBlocksDown);\n    } else {\n      this.setState({figure: getMovableBlock()});\n    }\n  }\n\n  componentDidMount() {\n    document.addEventListener(\"keydown\", this._handleKeyDown);\n    this.timerId = setInterval(this._makeRegularMove, Settings.updateRate);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener(\"keydown\", this._handleKeyDown);\n    clearInterval(this.timerID);\n  }\n\n  render() {\n    return (\n      <div className={'Tetris-stage'} style={this.style}>\n        {this.state.figure && this.state.figure.blocks.map((block, idx) => <TetrisBlock\n          key={idx}\n          position={block}\n          color={this.state.figure.color} />\n        )}\n\n        {this.state.blocksMap.map(function(row, y) {\n          return row.reduce(function(filtered, block, x) {\n            if (block) {\n              return filtered.concat(\n                <TetrisBlock\n                  key = {y * Settings.stageSize.width + x}\n                  position={{x, y}}\n                  color={block}\n                /> \n              )\n            } else {\n              return filtered;\n            }\n          }, [])\n        })}\n      </div>\n    )\n  }\n}\n\nexport default GameStage;"]},"metadata":{},"sourceType":"module"}