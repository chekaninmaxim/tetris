{"ast":null,"code":"var _jsxFileName = \"/home/ovo/projects/my-app/src/components/GameStage.js\";\nimport React, { useReducer, useEffect } from 'react';\nimport Settings, { getRealSize, addPx } from '../settings';\nimport TetrisBlock from './TetrisBlock';\nimport C from '../constants';\nimport { makeInitialState, blocksReducer } from '../state.js';\nconst key2Action = {\n  '32': {\n    type: C.ROTATE\n  },\n  '37': {\n    type: C.LEFT\n  },\n  '39': {\n    type: C.RIGHT\n  },\n  '40': {\n    type: C.DOWN\n  }\n};\n\nconst GameStage = () => {\n  const style = {\n    width: addPx(getRealSize(Settings.stageSize.width)),\n    height: addPx(getRealSize(Settings.stageSize.height))\n  };\n  const [state, dispatch] = useReducer(blocksReducer, makeInitialState());\n\n  const handleKeyDown = ({\n    keyCode\n  }) => {\n    const action = key2Action[keyCode];\n    if (action) dispatch(action);\n  };\n\n  const makeRegularMove = () => {\n    console.log('regular move');\n    dispatch({\n      type: C.DOWN\n    });\n  };\n\n  useEffect(() => {\n    if (state.gameStatus.gameOver) {\n      document.addEventListener(\"keydown\", handleKeyDown);\n      const timerId = setInterval(makeRegularMove, Settings.updateRate);\n      return () => {\n        console.log(\"REMOVING HANDLERS\");\n        document.removeEventListener(\"keydown\", handleKeyDown);\n        clearInterval(timerId);\n      };\n    }\n  }, [state.gameStatus.gameOver]);\n  useEffect(() => {\n    console.log(\"your score is \", state.gameStatus.score);\n  }, [state.gameStatus.score]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: 'Tetris-stage',\n    style: style,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 55,\n      columnNumber: 3\n    }\n  }, state.figure && state.figure.blocks.map((block, idx) => /*#__PURE__*/React.createElement(TetrisBlock, {\n    key: idx,\n    position: block,\n    color: state.figure.color,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 57,\n      columnNumber: 5\n    }\n  })), state.blocksMap.map(function (row, y) {\n    return row.reduce(function (filtered, block, x) {\n      if (block) {\n        return filtered.concat( /*#__PURE__*/React.createElement(TetrisBlock, {\n          key: y * Settings.stageSize.width + x,\n          position: {\n            x,\n            y\n          },\n          color: block,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 68,\n            columnNumber: 6\n          }\n        }));\n      } else {\n        return filtered;\n      }\n    }, []);\n  }), state.gameStatus.gameOver && /*#__PURE__*/React.createElement(\"h1\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 35\n    }\n  }, \" game over! \"));\n};\n\nexport default GameStage;","map":{"version":3,"sources":["/home/ovo/projects/my-app/src/components/GameStage.js"],"names":["React","useReducer","useEffect","Settings","getRealSize","addPx","TetrisBlock","C","makeInitialState","blocksReducer","key2Action","type","ROTATE","LEFT","RIGHT","DOWN","GameStage","style","width","stageSize","height","state","dispatch","handleKeyDown","keyCode","action","makeRegularMove","console","log","gameStatus","gameOver","document","addEventListener","timerId","setInterval","updateRate","removeEventListener","clearInterval","score","figure","blocks","map","block","idx","color","blocksMap","row","y","reduce","filtered","x","concat"],"mappings":"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","sourcesContent":["\nimport React, {useReducer, useEffect} from 'react';\nimport Settings, {getRealSize, addPx} from '../settings';\nimport TetrisBlock from './TetrisBlock';\nimport C from '../constants'\nimport {\n  makeInitialState,\n  blocksReducer\n} from '../state.js';\n\nconst key2Action = {\n  '32': {type: C.ROTATE},\n  '37': {type: C.LEFT},\n  '39': {type: C.RIGHT},\n  '40': {type: C.DOWN}\n}\n\nconst GameStage = () => {\n\n\tconst style = {\n\t\twidth: addPx(getRealSize(Settings.stageSize.width)),\n\t\theight: addPx(getRealSize(Settings.stageSize.height))\n\t}\n\n\tconst [state, dispatch] = useReducer(blocksReducer, makeInitialState());\n\n\tconst handleKeyDown = ({keyCode}) => {\n\t\tconst action = key2Action[keyCode];\n\t\tif (action) dispatch(action);\n\t}\n\n\tconst makeRegularMove = () => {\n\t\tconsole.log('regular move')\n\t\tdispatch({ type : C.DOWN });\n\t};\n\n\tuseEffect(() => {\n\t\tif (state.gameStatus.gameOver) {\n\n\t\t\tdocument.addEventListener(\"keydown\", handleKeyDown);\n\t\t\tconst timerId = setInterval(makeRegularMove, Settings.updateRate);\n\t\t\treturn () => {\n\t\t\t\tconsole.log(\"REMOVING HANDLERS\");\n\t\t\t\tdocument.removeEventListener(\"keydown\", handleKeyDown);\n\t\t\t\tclearInterval(timerId);\n\t\t\t}\n\t\t}\n\t}, [state.gameStatus.gameOver]);\n\n\tuseEffect(() => {\n\t\tconsole.log(\"your score is \", state.gameStatus.score);\n\t}, [state.gameStatus.score])\n\n\treturn (\n\t\t<div className={'Tetris-stage'} style={style}>\n\t\t\t{state.figure && state.figure.blocks.map((block, idx) =>\n\t\t\t\t<TetrisBlock\n\t\t\t\t\tkey={idx}\n\t\t\t\t\tposition={block}\n\t\t\t\t\tcolor={state.figure.color}\n\t\t\t\t/>\n\t\t\t)}\n\n\t\t\t{state.blocksMap.map(function(row, y) {\n\t\t\treturn row.reduce(function(filtered, block, x) {\n\t\t\t\tif (block) {\n\t\t\t\treturn filtered.concat(\n\t\t\t\t\t<TetrisBlock\n\t\t\t\t\tkey = {y * Settings.stageSize.width + x}\n\t\t\t\t\tposition={{x, y}}\n\t\t\t\t\tcolor={block}\n\t\t\t\t\t/> \n\t\t\t\t)\n\t\t\t\t} else {\n\t\t\t\treturn filtered;\n\t\t\t\t}\n\t\t\t}, [])\n\t\t\t})}\n\n\t\t\t{ state.gameStatus.gameOver && <h1> game over! </h1> }\n\t\t</div>\n\t)\n}\n\nexport default GameStage;"]},"metadata":{},"sourceType":"module"}